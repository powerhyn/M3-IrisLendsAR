# IrisLensSDK 프로젝트 명세서

## 1. 프로젝트 개요

### 1.1 목적
실시간 카메라 영상에서 홍채를 추적하여 가상 렌즈를 오버레이하는 AR 피팅 SDK 개발

### 1.2 핵심 기능
- 실시간 홍채 검출 및 추적 (30fps 이상)
- 가상 렌즈 오버레이 렌더링
- 크로스플랫폼 SDK 제공 (Android, iOS, Flutter, Web)

### 1.3 타겟 사용자
- 콘택트렌즈 판매 앱/웹 개발자
- AR 뷰티 앱 개발자
- 안경/렌즈 피팅 솔루션 제공 업체

---

## 2. 기술 스택

### 2.1 코어 엔진 (C++)

| 구성요소 | 기술 | 버전 | 용도 |
|----------|------|------|------|
| 홍채 검출 | MediaPipe | Latest | Face Mesh + Iris Landmark |
| 이미지 처리 | OpenCV | 4.x | 전처리, 렌즈 합성 |
| ML 런타임 | TensorFlow Lite | 2.x | 커스텀 모델 (Phase 2) |
| 빌드 시스템 | CMake | 3.18+ | 크로스플랫폼 빌드 |

### 2.2 플랫폼별 바인딩

| 플랫폼 | 바인딩 기술 | 결과물 |
|--------|-------------|--------|
| Android | JNI + NDK | libiris_sdk.so → AAR |
| iOS | Objective-C++ | IrisSDK.xcframework |
| Flutter | dart:ffi | Flutter Plugin |
| Web | Emscripten | WASM + JS |

### 2.3 의존성 관계

```
MediaPipe
    ├── TensorFlow Lite (내장)
    ├── OpenCV (일부 기능)
    └── Protobuf

OpenCV
    └── 독립적

TensorFlow Lite
    └── 독립적 (커스텀 모델용)
```

---

## 3. 시스템 요구사항

### 3.1 최소 사양

| 플랫폼 | 요구사항 |
|--------|----------|
| Android | API 24+ (Android 7.0), ARM64/ARMv7/x86_64 |
| iOS | iOS 12.0+, ARM64 |
| Web | WebAssembly 지원 브라우저 |

### 3.2 권장 사양

| 항목 | 권장 |
|------|------|
| 카메라 | 720p 이상, 30fps |
| CPU | ARM64 기준 mid-range 이상 |
| 메모리 | 100MB 이상 가용 |

---

## 4. 핵심 제약사항

### 4.1 MediaPipe 한계 (Phase 1)

| 상황 | 동작 | 대응 |
|------|------|------|
| 얼굴 전체 인식 | ✅ 정상 동작 | - |
| 눈만 클로즈업 | ❌ 실패 | UX 가이드로 우회 |
| 얼굴 반쪽 | △ 불안정 | 품질 점수 기반 필터링 |
| 극단적 각도 (45°+) | △ 불안정 | 사용자 안내 |

### 4.2 해결 전략 (Phase 2)

```
하이브리드 검출 시스템
├── 1차: MediaPipe 시도
│   └── 성공 시 → MediaPipe 결과 사용
└── 2차: Eye-Only 모델 시도 (커스텀)
    └── 성공 시 → 커스텀 모델 결과 사용
```

---

## 5. 성능 목표

| 지표 | 목표 | 측정 방법 |
|------|------|----------|
| 프레임 레이트 | 30fps 이상 | 1초당 처리 프레임 수 |
| 검출 지연 | 33ms 이하 | 입력→출력 시간 |
| 메모리 사용 | 100MB 이하 | 런타임 메모리 |
| SDK 크기 | 20MB 이하 | 라이브러리 파일 크기 |
| 검출 정확도 | 95% 이상 | 정상 조건 기준 |

---

## 6. 보안 고려사항

### 6.1 카메라 데이터
- 프레임 데이터 외부 전송 없음 (온디바이스 처리)
- 처리 완료 후 즉시 메모리 해제

### 6.2 모델 보호
- 모델 파일 암호화 옵션 제공
- 무결성 검증 기능

---

## 7. 라이선스 검토

| 라이브러리 | 라이선스 | 상용 사용 |
|------------|----------|----------|
| MediaPipe | Apache 2.0 | ✅ 가능 |
| OpenCV | Apache 2.0 | ✅ 가능 |
| TensorFlow Lite | Apache 2.0 | ✅ 가능 |

---

## 8. 확장 계획

### Phase 1 → Phase 2 전환 시
- Eye-Only 커스텀 모델 학습
- 하이브리드 검출 시스템 구축
- 모델 교체 가능한 인터페이스 활용

### 추후 기능 확장
- 다중 렌즈 스타일 지원
- 렌즈 색상 커스터마이징
- 눈 깜빡임 감지 및 처리
- 조명 반사 시뮬레이션
